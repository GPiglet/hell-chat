import * as React from 'react';
import { NextPage } from 'next';
import Head from 'next/head';
import Box from '@mui/material/Box';
import CssBaseline from '@mui/material/CssBaseline';
import Footer from '../components/Footer';
import Header from '../components/Header';
import SearchBar from '../components/SearchBar';
import FriendList from '../components/FriendList';
import ChatContent from '../components/ChatContent';
import { SelectFriendContext } from '../contexts/FriendContext';
import { MessageContext, MessageType } from '../contexts/MessageContext';



const Home: NextPage = () => {
    const [selectedFriend, setSelectedFriend] = React.useState(null);
    const selectFriend = (user: any) => {
        setSelectedFriend(user);
    };

    const [messages, setMessages] = React.useState<Array<MessageType>>([]);

    const pushMessage = (msg: Array<MessageType>, isReset: boolean) => {
        if ( isReset )
            setMessages(msg);
        else
            setMessages([...messages, ...msg]);
    };

    return (    
        <SelectFriendContext.Provider value={{user: selectedFriend, selectFriend}} >
        <MessageContext.Provider value={{list: messages, push: pushMessage}} >
            <Head>
                <title>Piggies Chat</title>
                <meta name="description" content="Generated by create next app" />
                <link rel="icon" href="/favicon.ico" />
            </Head>
            <CssBaseline />
            <Box
                sx = {{
                    display: 'flex'
                }}
            >
                <Box
                    sx = {{
                        width: {xs: '100%', sm: 420},
                    }}
                >
                    <Header />
                    <SearchBar />
                    <FriendList />
                </Box>
                <ChatContent/>
            </Box>
            <Footer />
        </MessageContext.Provider>
        </SelectFriendContext.Provider>
    )
}

export default Home;